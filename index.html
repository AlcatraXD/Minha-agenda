<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Manicure Pro - Gest√£o Elegante</title>
<meta name="theme-color" content="#ec4899">
<meta name="description" content="Sistema completo de gest√£o para profissionais de manicure e beleza">
<link rel="manifest" href="manifest.json">

<style>
  :root {
    --primary: #ec4899; --primary-dark: #db2777; 
    --primary-light: #fdf2f8;
    --secondary: #8b5cf6; --secondary-dark: #7c3aed;
    --success: #10b981; --success-dark: #059669;
    --danger: #ef4444; --danger-dark: #dc2626;
    --warning: #f59e0b; --warning-dark: #d97706;
    --info: #3b82f6; --info-dark: #2563eb;
    --bg: #fafafa; --card: #ffffff; --text: #1f2937; --muted: #6b7280; --border: #e5e7eb;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --radius: 16px;
    --radius-sm: 12px;
    --gradient: linear-gradient(135deg, #ec4899, #8b5cf6);
    --gradient-light: linear-gradient(135deg, #fdf2f8, #f3f4f6);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  [data-theme="dark"] {
    --primary: #f472b6; --primary-dark: #ec4899;
    --secondary: #a78bfa; --secondary-dark: #8b5cf6;
    --primary-light: #1f2937;
    --bg: #111827; --card: #1f2937; --text: #f9fafb; --muted: #9ca3af; --border: #374151;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
    --gradient: linear-gradient(135deg, #f472b6, #a78bfa);
    --gradient-light: linear-gradient(135deg, #1f2937, #374151);
  }

  * { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    margin: 0; 
    background: var(--bg); 
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    line-height: 1.6;
    min-height: 100vh;
    transition: var(--transition);
  }

  /* Header Moderno */
  .app-header {
    background: var(--gradient);
    color: white;
    padding: 20px 24px;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .app-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.1;
  }

  .app-title {
    font-size: 1.6rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    position: relative;
    z-index: 1;
  }

  .header-actions {
    position: absolute;
    right: 24px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 12px;
    z-index: 1;
  }

  .theme-toggle, .sync-status {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 20px;
    padding: 10px 16px;
    color: white;
    cursor: pointer;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: var(--transition);
    font-weight: 600;
  }

  .theme-toggle:hover, .sync-status:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-1px);
  }

  .sync-status.offline {
    background: rgba(245, 158, 11, 0.3);
  }

  .sync-status.syncing {
    background: rgba(59, 130, 246, 0.3);
  }

  /* Navega√ß√£o Elegante */
  .app-nav {
    display: flex;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
    padding: 0 16px;
    box-shadow: var(--shadow);
    overflow-x: auto;
    scrollbar-width: none;
  }

  .app-nav::-webkit-scrollbar {
    display: none;
  }

  .nav-btn {
    flex: 1;
    background: transparent;
    border: none;
    padding: 18px 16px;
    font-weight: 600;
    cursor: pointer;
    color: var(--muted);
    transition: var(--transition);
    font-size: 0.95rem;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 120px;
    white-space: nowrap;
  }

  .nav-btn::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: var(--primary);
    border-radius: 3px 3px 0 0;
    transition: var(--transition);
    transform: translateX(-50%);
  }

  .nav-btn.active {
    color: var(--primary);
    font-weight: 700;
  }

  .nav-btn.active::before {
    width: 80%;
  }

  .nav-btn:hover {
    color: var(--primary);
    background: var(--primary-light);
  }

  /* Conte√∫do Principal */
  .app-main {
    padding: 24px;
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 100px;
  }

  .section {
    display: none;
    animation: fadeInUp 0.4s ease;
  }

  .section.active {
    display: block;
  }

  @keyframes fadeInUp {
    from { 
      opacity: 0; 
      transform: translateY(20px); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0); 
    }
  }

  /* Cards Modernos */
  .card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 24px;
    margin-bottom: 20px;
    transition: var(--transition);
    border: 1px solid var(--border);
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .section-title {
    color: var(--text);
    margin: 32px 0 20px;
    font-size: 1.5rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 2px;
    background: var(--gradient);
    border-radius: 2px;
  }

  /* Formul√°rios Elegantes */
  .form-group {
    margin-bottom: 20px;
  }

  .form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text);
    font-size: 0.95rem;
  }

  .form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 1rem;
    transition: var(--transition);
    background: var(--card);
    color: var(--text);
    font-family: inherit;
  }

  .form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1);
    transform: translateY(-1px);
  }

  /* Bot√µes Modernos */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 16px 24px;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    min-height: 56px;
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }

  .btn:hover::before {
    left: 100%;
  }

  .btn-block {
    width: 100%;
  }

  .btn-primary { 
    background: var(--gradient); 
    color: white; 
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
  }

  .btn-success { 
    background: linear-gradient(135deg, var(--success), var(--success-dark)); 
    color: white; 
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .btn-danger { 
    background: linear-gradient(135deg, var(--danger), var(--danger-dark)); 
    color: white; 
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
  }

  .btn-warning { 
    background: linear-gradient(135deg, var(--warning), var(--warning-dark)); 
    color: white; 
    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
  }

  .btn-info { 
    background: linear-gradient(135deg, var(--info), var(--info-dark)); 
    color: white; 
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  .btn-outline { 
    background: transparent; 
    border: 2px solid var(--primary); 
    color: var(--primary);
    position: relative;
    z-index: 1;
  }

  .btn-outline::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: var(--gradient);
    transition: width 0.3s ease;
    z-index: -1;
  }

  .btn-outline:hover::after {
    width: 100%;
  }

  .btn-outline:hover {
    color: white;
    border-color: transparent;
  }

  .btn:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }

  /* Listas e Itens */
  .list {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .list-item {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    transition: var(--transition);
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .list-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient);
    transform: scaleY(0);
    transition: transform 0.3s ease;
  }

  .list-item:hover::before {
    transform: scaleY(1);
  }

  .list-item:hover {
    transform: translateX(8px);
    box-shadow: var(--shadow-lg);
  }

  .client-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
  }

  .client-name {
    font-weight: 700;
    font-size: 1.2rem;
    color: var(--text);
  }

  .client-meta {
    color: var(--muted);
    font-size: 0.9rem;
    margin-bottom: 8px;
    line-height: 1.5;
  }

  .client-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 16px;
  }

  .client-actions .btn {
    flex: 1;
    min-width: 140px;
    font-size: 0.9rem;
    padding: 12px 16px;
    min-height: 44px;
  }

  /* KPIs e Estat√≠sticas Modernas */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 24px 0;
  }

  .kpi-card {
    background: var(--card);
    padding: 24px;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .kpi-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary);
  }

  .kpi-card.success::before { background: var(--success); }
  .kpi-card.warning::before { background: var(--warning); }
  .kpi-card.info::before { background: var(--info); }

  .kpi-value {
    font-size: 2.2rem;
    font-weight: 800;
    color: var(--primary);
    margin: 12px 0;
    line-height: 1;
  }

  .kpi-card.success .kpi-value { color: var(--success); }
  .kpi-card.warning .kpi-value { color: var(--warning); }
  .kpi-card.info .kpi-value { color: var(--info); }

  .kpi-label {
    font-size: 0.95rem;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Modais Elegantes */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
  }

  .modal.active {
    opacity: 1;
    visibility: visible;
  }

  .modal-content {
    background: var(--card);
    border-radius: var(--radius);
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    transform: scale(0.9) translateY(20px);
    transition: var(--transition);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
  }

  .modal.active .modal-content {
    transform: scale(1) translateY(0);
  }

  .modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--gradient-light);
  }

  .modal-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--text);
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--muted);
    padding: 8px;
    border-radius: 8px;
    transition: var(--transition);
  }

  .modal-close:hover {
    background: var(--primary-light);
    color: var(--primary);
  }

  .modal-body {
    padding: 24px;
  }

  /* Servi√ßos no Modal */
  .service-option {
    display: flex;
    align-items: center;
    padding: 16px;
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    margin-bottom: 12px;
    cursor: pointer;
    transition: var(--transition);
    background: var(--card);
  }

  .service-option:hover {
    border-color: var(--primary);
    background: var(--primary-light);
    transform: translateX(4px);
  }

  .service-checkbox {
    margin-right: 16px;
    transform: scale(1.2);
  }

  .service-info {
    flex: 1;
  }

  .service-name {
    font-weight: 600;
    color: var(--text);
    font-size: 1.1rem;
  }

  .service-price {
    color: var(--primary);
    font-weight: 700;
    font-size: 1.1rem;
  }

  /* Estados Vazios */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .empty-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.5;
  }

  .empty-text {
    font-size: 1.3rem;
    margin-bottom: 12px;
    font-weight: 600;
  }

  .empty-subtext {
    font-size: 1rem;
    opacity: 0.7;
    line-height: 1.6;
  }

  /* Toast Notifications */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--card);
    color: var(--text);
    padding: 16px 24px;
    border-radius: var(--radius-sm);
    z-index: 2000;
    font-size: 0.95rem;
    transition: var(--transition);
    max-width: 400px;
    text-align: center;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border);
    backdrop-filter: blur(10px);
  }

  .toast.show {
    transform: translateX(-50%) translateY(0);
  }

  .toast.success { 
    border-left: 4px solid var(--success); 
    background: linear-gradient(135deg, var(--card), #f0fdf4);
  }
  .toast.error { 
    border-left: 4px solid var(--danger); 
    background: linear-gradient(135deg, var(--card), #fef2f2);
  }
  .toast.warning { 
    border-left: 4px solid var(--warning); 
    background: linear-gradient(135deg, var(--card), #fffbeb);
  }

  /* Utilit√°rios */
  .text-success { color: var(--success); }
  .text-danger { color: var(--danger); }
  .text-warning { color: var(--warning); }
  .text-muted { color: var(--muted); }
  .d-none { display: none; }

  /* A√ß√µes R√°pidas */
  .quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
    margin: 20px 0;
  }

  .quick-action-btn {
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .quick-action-btn:hover {
    border-color: var(--primary);
    background: var(--primary-light);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  .service-tag {
    display: inline-block;
    background: var(--gradient);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-right: 8px;
    margin-bottom: 4px;
  }

  /* Estat√≠sticas */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }

  .stat-card {
    background: var(--card);
    padding: 20px;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--primary);
    margin: 12px 0;
    line-height: 1;
  }

  .stat-label {
    font-size: 0.9rem;
    color: var(--muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* Dashboard Interativo */
  .chart-container {
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px;
    margin: 20px 0;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .chart-title {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 20px;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chart {
    width: 100%;
    height: 200px;
    position: relative;
    overflow: hidden;
  }

  .chart-bar {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    height: 150px;
    margin-bottom: 30px;
  }

  .bar {
    flex: 1;
    margin: 0 6px;
    background: var(--gradient);
    border-radius: 6px 6px 0 0;
    position: relative;
    transition: var(--transition);
    cursor: pointer;
  }

  .bar:hover {
    opacity: 0.8;
    transform: scaleY(1.05);
  }

  .bar-label {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    color: var(--muted);
    white-space: nowrap;
    font-weight: 600;
  }

  .bar-value {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--text);
  }

  /* Comparativos */
  .comparison-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
  }

  .comparison-card {
    background: var(--card);
    padding: 20px;
    border-radius: var(--radius);
    text-align: center;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .comparison-value {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 12px 0;
    line-height: 1;
  }

  .positive { color: var(--success); }
  .negative { color: var(--danger); }
  .neutral { color: var(--muted); }

  /* Exporta√ß√£o */
  .export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
    margin: 20px 0;
  }

  /* Busca e Filtros */
  .search-container {
    position: relative;
    margin-bottom: 20px;
  }

  .search-input {
    padding-left: 45px;
  }

  .search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
  }

  /* Agendamentos */
  .calendar-container {
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px;
    margin: 20px 0;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
  }

  .calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
    background: var(--bg);
  }

  .calendar-day:hover {
    background: var(--primary-light);
    color: var(--primary);
  }

  .calendar-day.active {
    background: var(--gradient);
    color: white;
  }

  .calendar-day.has-event::after {
    content: '';
    position: absolute;
    bottom: 4px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--primary);
  }

  /* Loading */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .app-main { padding: 16px; }
    .card { padding: 20px; }
    .kpi-grid { grid-template-columns: 1fr 1fr; }
    .client-actions .btn { min-width: calc(50% - 5px); }
    .nav-btn { padding: 16px 12px; font-size: 0.9rem; }
    .comparison-grid { grid-template-columns: 1fr; }
    .header-actions { 
      position: static; 
      transform: none; 
      justify-content: center; 
      margin-top: 12px; 
    }
    .app-header { padding: 16px 20px; }
    .calendar-grid {
      grid-template-columns: repeat(7, 1fr);
      font-size: 0.8rem;
    }
  }

  @media (max-width: 480px) {
    .kpi-grid { grid-template-columns: 1fr; }
    .client-actions .btn { min-width: 100%; }
    .quick-actions { grid-template-columns: 1fr; }
    .export-options { grid-template-columns: 1fr; }
    .calendar-grid {
      gap: 4px;
    }
  }
</style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div class="app-title">
      <span>üíÖ</span>
      <span>Manicure Pro</span>
    </div>
    <div class="header-actions">
      <button class="theme-toggle" id="theme-toggle">
        <span class="theme-icon">üåô</span>
        <span class="theme-text">Escuro</span>
      </button>
      <button class="sync-status" id="sync-status">
        <span class="sync-icon">‚úÖ</span>
        <span class="sync-text">Online</span>
      </button>
    </div>
  </header>

  <!-- Navega√ß√£o -->
  <nav class="app-nav">
    <button class="nav-btn active" data-tab="clientes">
      <span>üë•</span>
      <span>Clientes</span>
    </button>
    <button class="nav-btn" data-tab="servicos">
      <span>üíÖ</span>
      <span>Servi√ßos</span>
    </button>
    <button class="nav-btn" data-tab="agendamentos">
      <span>üìÖ</span>
      <span>Agendamentos</span>
    </button>
    <button class="nav-btn" data-tab="relatorios">
      <span>üìä</span>
      <span>Dashboard</span>
    </button>
    <button class="nav-btn" data-tab="backup">
      <span>üõ°Ô∏è</span>
      <span>Backup</span>
    </button>
  </nav>

  <!-- Conte√∫do Principal -->
  <main class="app-main">
    <!-- Se√ß√£o Clientes -->
    <section id="clientes" class="section active">
      <h2 class="section-title">üë• Gest√£o de Clientes</h2>
      
      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="form-input search-input" id="busca-cliente" placeholder="Buscar cliente por nome...">
      </div>
      
      <div class="quick-actions">
        <div class="quick-action-btn" data-filter="todas">
          <span>üë•</span>
          <span>Todas as Clientes</span>
        </div>
        <div class="quick-action-btn" data-filter="fieis">
          <span>‚≠ê</span>
          <span>Clientes Fi√©is</span>
        </div>
        <div class="quick-action-btn" data-filter="recentes">
          <span>üÜï</span>
          <span>Clientes Recentes</span>
        </div>
      </div>
      
      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">‚ûï Nova Cliente</h3>
        <form id="form-cliente">
          <div class="form-group">
            <label class="form-label">Nome da Cliente *</label>
            <input type="text" class="form-input" id="cliente-nome" placeholder="Ex: Maria Silva" required>
          </div>
          <div class="form-group">
            <label class="form-label">Telefone</label>
            <input type="tel" class="form-input" id="cliente-telefone" placeholder="Ex: (11) 99999-9999">
          </div>
          <div class="form-group">
            <label class="form-label">Observa√ß√µes</label>
            <textarea class="form-textarea" id="cliente-observacoes" placeholder="Alergias, prefer√™ncias, etc." rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-primary btn-block">üíæ Salvar Cliente</button>
        </form>
      </div>

      <h2 class="section-title">üìã Lista de Clientes</h2>
      <div id="lista-clientes" class="list"></div>
    </section>

    <!-- Se√ß√£o Servi√ßos -->
    <section id="servicos" class="section">
      <h2 class="section-title">üíÖ Cat√°logo de Servi√ßos</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-servicos">0</div>
          <div class="stat-label">Total de Servi√ßos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="servicos-ativos">0</div>
          <div class="stat-label">Servi√ßos Ativos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="servico-mais-vendido">-</div>
          <div class="stat-label">Mais Vendido</div>
        </div>
      </div>
      
      <div class="quick-actions">
        <div class="quick-action-btn" data-filter="todos">
          <span>‚úÖ</span>
          <span>Todos os Servi√ßos</span>
        </div>
        <div class="quick-action-btn" data-filter="ativos">
          <span>üî•</span>
          <span>Servi√ßos Ativos</span>
        </div>
        <div class="quick-action-btn" data-filter="populares">
          <span>‚≠ê</span>
          <span>Servi√ßos Populares</span>
        </div>
      </div>
      
      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">‚ûï Novo Servi√ßo</h3>
        <form id="form-servico">
          <div class="form-group">
            <label class="form-label">Nome do Servi√ßo *</label>
            <input type="text" class="form-input" id="servico-nome" placeholder="Ex: Manicure Completa" required>
          </div>
          <div class="form-group">
            <label class="form-label">Pre√ßo (R$) *</label>
            <input type="number" class="form-input" id="servico-preco" placeholder="Ex: 35.00" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label class="form-label">Dura√ß√£o (minutos)</label>
            <input type="number" class="form-input" id="servico-duracao" placeholder="Ex: 60" min="5" step="5">
          </div>
          <div class="form-group">
            <label class="form-label">Categoria</label>
            <select class="form-select" id="servico-categoria">
              <option value="basico">B√°sico</option>
              <option value="completo">Completo</option>
              <option value="especial">Especial</option>
              <option value="spa">SPA</option>
              <option value="premium">Premium</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Descri√ß√£o</label>
            <textarea class="form-textarea" id="servico-descricao" placeholder="Descreva o servi√ßo..." rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="servico-ativo" checked style="margin-right: 8px;">
              Servi√ßo ativo
            </label>
          </div>
          <button type="submit" class="btn btn-primary btn-block">üíæ Salvar Servi√ßo</button>
        </form>
      </div>

      <h2 class="section-title">üì¶ Servi√ßos Cadastrados</h2>
      <div id="lista-servicos" class="list"></div>
    </section>

    <!-- Se√ß√£o Agendamentos -->
    <section id="agendamentos" class="section">
      <h2 class="section-title">üìÖ Agendamentos</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="agendamentos-hoje">0</div>
          <div class="stat-label">Agendamentos Hoje</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="agendamentos-semana">0</div>
          <div class="stat-label">Esta Semana</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="taxa-comparecimento">0%</div>
          <div class="stat-label">Taxa de Comparecimento</div>
        </div>
      </div>

      <div class="calendar-container">
        <div class="calendar-header">
          <button class="btn btn-outline" id="prev-month">‚Äπ</button>
          <h3 id="current-month">Mar√ßo 2024</h3>
          <button class="btn btn-outline" id="next-month">‚Ä∫</button>
        </div>
        <div class="calendar-grid" id="calendar">
          <!-- Gerado dinamicamente -->
        </div>
      </div>

      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">‚ûï Novo Agendamento</h3>
        <form id="form-agendamento">
          <div class="form-group">
            <label class="form-label">Cliente *</label>
            <select class="form-select" id="agendamento-cliente" required>
              <option value="">Selecione uma cliente</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Data e Hora *</label>
            <input type="datetime-local" class="form-input" id="agendamento-datahora" required>
          </div>
          <div class="form-group">
            <label class="form-label">Servi√ßos *</label>
            <div id="lista-servicos-agendamento" class="list"></div>
          </div>
          <div class="form-group">
            <label class="form-label">Observa√ß√µes</label>
            <textarea class="form-textarea" id="agendamento-observacoes" placeholder="Observa√ß√µes sobre o agendamento..." rows="3"></textarea>
          </div>
          <button type="submit" class="btn btn-success btn-block">üìÖ Agendar</button>
        </form>
      </div>

      <h2 class="section-title">üìã Pr√≥ximos Agendamentos</h2>
      <div id="lista-agendamentos" class="list"></div>
    </section>

    <!-- Se√ß√£o Dashboard -->
    <section id="relatorios" class="section">
      <h2 class="section-title">üìä Dashboard Interativo</h2>
      
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-label">A Receber</div>
          <div class="kpi-value" id="kpi-pendente">R$ 0,00</div>
        </div>
        <div class="kpi-card success">
          <div class="kpi-label">Recebido (M√™s)</div>
          <div class="kpi-value" id="kpi-recebido">R$ 0,00</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">Total (M√™s)</div>
          <div class="kpi-value" id="kpi-total">R$ 0,00</div>
        </div>
        <div class="kpi-card info">
          <div class="kpi-label">Clientes (M√™s)</div>
          <div class="kpi-value" id="kpi-clientes">0</div>
        </div>
      </div>

      <!-- Comparativos Temporais -->
      <div class="comparison-grid">
        <div class="comparison-card">
          <div class="stat-label">Vs M√™s Anterior</div>
          <div class="comparison-value" id="comparativo-mes">+0%</div>
          <div class="stat-label">Faturamento</div>
        </div>
        <div class="comparison-card">
          <div class="stat-label">Vs M√™s Anterior</div>
          <div class="comparison-value" id="comparativo-clientes">+0%</div>
          <div class="stat-label">Novos Clientes</div>
        </div>
      </div>

      <!-- Gr√°ficos -->
      <div class="chart-container">
        <div class="chart-title">üìà Faturamento Mensal (√öltimos 6 meses)</div>
        <div class="chart">
          <div class="chart-bar" id="grafico-faturamento">
            <!-- Gerado dinamicamente -->
          </div>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-title">üéØ Servi√ßos Mais Populares</div>
        <div class="chart">
          <div class="chart-bar" id="grafico-servicos">
            <!-- Gerado dinamicamente -->
          </div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-clientes">0</div>
          <div class="stat-label">Total Clientes</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="atendimentos-mes">0</div>
          <div class="stat-label">Atendimentos/M√™s</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="ticket-medio">R$ 0,00</div>
          <div class="stat-label">Ticket M√©dio</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="clientes-fieis">0</div>
          <div class="stat-label">Clientes Fi√©is</div>
        </div>
      </div>
    </section>

    <!-- Se√ß√£o Backup -->
    <section id="backup" class="section">
      <h2 class="section-title">üõ°Ô∏è Backup e Exporta√ß√£o</h2>
      
      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">üíæ Backup Autom√°tico</h3>
        <div class="form-group">
          <label class="form-label">
            <input type="checkbox" id="backup-automatico" checked style="margin-right: 8px;">
            Backup autom√°tico a cada 5 minutos
          </label>
        </div>
        <div class="client-meta">
          <strong>√öltimo backup:</strong> <span id="ultimo-backup">Nunca</span>
        </div>
        <button class="btn btn-success btn-block" id="btn-backup">
          üîÑ Fazer Backup Agora
        </button>
      </div>

      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">üì§ Exportar Relat√≥rios</h3>
        <div class="export-options">
          <button class="btn btn-outline" data-export="completo">
            <span>üìä</span>
            <span>Dados Completos</span>
          </button>
          <button class="btn btn-outline" data-export="financeiro">
            <span>üí∞</span>
            <span>Relat√≥rio Financeiro</span>
          </button>
          <button class="btn btn-outline" data-export="clientes">
            <span>üë•</span>
            <span>Lista de Clientes</span>
          </button>
          <button class="btn btn-outline" data-export="servicos">
            <span>üíÖ</span>
            <span>Cat√°logo de Servi√ßos</span>
          </button>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">üì• Restaurar Backup</h3>
        <div class="form-group">
          <label class="form-label">Selecionar arquivo de backup</label>
          <input type="file" class="form-input" id="arquivo-backup" accept=".json">
        </div>
        <button class="btn btn-warning btn-block" id="btn-restaurar">
          üîÑ Restaurar Dados
        </button>
      </div>

      <div class="card">
        <h3 style="margin-bottom: 20px; color: var(--primary);">‚ÑπÔ∏è Status do Sistema</h3>
        <div class="client-meta">
          <strong>Armazenamento usado:</strong> <span id="armazenamento-usado">0 KB</span><br>
          <strong>Total de registros:</strong> <span id="total-registros">0</span><br>
          <strong>Backups autom√°ticos:</strong> <span id="backups-realizados">0</span><br>
          <strong>Vers√£o:</strong> <span id="versao-app">2.0.0</span>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal Atendimento -->
  <div id="modal-atendimento" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">üéØ Novo Atendimento</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-atendimento">
          <input type="hidden" id="atendimento-cliente-id">
          
          <div class="form-group">
            <label class="form-label">Cliente</label>
            <div id="atendimento-cliente-info" style="padding: 16px; background: var(--primary-light); border-radius: var(--radius-sm); font-weight: 600; border: 1px solid var(--border);"></div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Data do Atendimento</label>
            <input type="date" class="form-input" id="atendimento-data" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Servi√ßos Prestados *</label>
            <div id="lista-servicos-modal" class="list"></div>
          </div>
          
          <div class="form-group">
            <label class="form-label">Observa√ß√µes</label>
            <textarea class="form-textarea" id="atendimento-observacoes" placeholder="Observa√ß√µes sobre o atendimento..." rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Valor Total</label>
            <input type="text" class="form-input" id="atendimento-valor-total" readonly style="font-weight: 700; font-size: 1.3rem; background: var(--primary-light);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Status do Pagamento</label>
            <select class="form-select" id="atendimento-status-pagamento">
              <option value="pendente">‚è≥ Pendente</option>
              <option value="pago">‚úÖ Pago</option>
              <option value="parcial">üîÑ Parcial</option>
            </select>
          </div>
          
          <div class="form-group">
            <button type="submit" class="btn btn-success btn-block">üíæ Salvar Atendimento</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script>
  // =============================================
  // APLICA√á√ÉO MANICURE - VERS√ÉO MELHORADA 2.0
  // =============================================

  // Estado da aplica√ß√£o
  const state = {
    clientes: [],
    servicos: [],
    atendimentos: [],
    agendamentos: [],
    config: {
      tema: 'light',
      backupAutomatico: true,
      ultimoBackup: null,
      versao: '2.0.0'
    }
  };

  // Utilit√°rios
  const utils = {
    formatarMoeda: (valor) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor || 0),
    formatarData: (dataISO) => dataISO ? new Date(dataISO).toLocaleDateString('pt-BR') : 'Nunca',
    formatarDataHora: (dataISO) => dataISO ? new Date(dataISO).toLocaleString('pt-BR') : 'Nunca',
    gerarId: () => Date.now().toString() + Math.random().toString(36).substr(2, 5),
    calcularDiferencaPercentual: (atual, anterior) => {
      if (!anterior || anterior === 0) return 100;
      return ((atual - anterior) / anterior * 100).toFixed(1);
    },
    formatarTelefone: (telefone) => {
      if (!telefone) return '';
      const nums = telefone.replace(/\D/g, '');
      if (nums.length === 11) {
        return `(${nums.substring(0,2)}) ${nums.substring(2,7)}-${nums.substring(7)}`;
      }
      if (nums.length === 10) {
        return `(${nums.substring(0,2)}) ${nums.substring(2,6)}-${nums.substring(6)}`;
      }
      return telefone;
    },
    debounce: (func, wait) => {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
  };

  // Interface
  const ui = {
    mostrarToast(mensagem, tipo = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = mensagem;
      toast.className = `toast ${tipo} show`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    },

    abrirModal(id) {
      document.getElementById(id).classList.add('active');
    },

    fecharModal(id) {
      document.getElementById(id).classList.remove('active');
    },

    mudarAba(abaId) {
      // Remover active de todos os bot√µes
      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Remover active de todas as se√ß√µes
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      // Adicionar active ao bot√£o e se√ß√£o correspondentes
      const btnAtivo = document.querySelector(`[data-tab="${abaId}"]`);
      const sectionAtiva = document.getElementById(abaId);
      
      if (btnAtivo && sectionAtiva) {
        btnAtivo.classList.add('active');
        sectionAtiva.classList.add('active');
        
        // Atualizar dados espec√≠ficos da aba
        if (abaId === 'relatorios') {
          relatorios.atualizar();
          relatorios.criarGraficos();
        }
        if (abaId === 'servicos') servicos.atualizarEstatisticas();
        if (abaId === 'backup') backup.atualizarStatus();
        if (abaId === 'agendamentos') {
          agendamentos.atualizarEstatisticas();
          agendamentos.criarCalendario();
        }
      }
    },

    toggleTheme() {
      state.config.tema = state.config.tema === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', state.config.tema);
      storage.salvar();
      
      const toggle = document.getElementById('theme-toggle');
      const icon = toggle.querySelector('.theme-icon');
      const text = toggle.querySelector('.theme-text');
      
      if (state.config.tema === 'light') {
        icon.textContent = 'üåô';
        text.textContent = 'Escuro';
      } else {
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Claro';
      }
    },

    aplicarTema() {
      document.body.setAttribute('data-theme', state.config.tema);
      const toggle = document.getElementById('theme-toggle');
      const icon = toggle.querySelector('.theme-icon');
      const text = toggle.querySelector('.theme-text');
      
      if (state.config.tema === 'light') {
        icon.textContent = 'üåô';
        text.textContent = 'Escuro';
      } else {
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Claro';
      }
    },

    mostrarLoading(btn) {
      const originalText = btn.innerHTML;
      btn.innerHTML = '<div class="loading"></div>';
      btn.disabled = true;
      return () => {
        btn.innerHTML = originalText;
        btn.disabled = false;
      };
    }
  };

  // Armazenamento
  const storage = {
    carregar() {
      const dados = localStorage.getItem('manicureApp');
      if (dados) {
        const dadosCarregados = JSON.parse(dados);
        Object.assign(state, dadosCarregados);
        
        // Migra√ß√£o de vers√£o se necess√°rio
        if (!state.config.versao || state.config.versao !== '2.0.0') {
          this.migrarDados();
        }
      } else {
        // Dados iniciais
        state.servicos = [
          { id: '1', nome: "Manicure Simples", preco: 25.00, categoria: "basico", ativo: true, vendas: 0, duracao: 30 },
          { id: '2', nome: "Pedicure Simples", preco: 30.00, categoria: "basico", ativo: true, vendas: 0, duracao: 45 },
          { id: '3', nome: "Manicure Completa", preco: 40.00, categoria: "completo", ativo: true, vendas: 0, duracao: 60 },
          { id: '4', nome: "SPA dos P√©s", preco: 50.00, categoria: "spa", ativo: true, vendas: 0, duracao: 75 }
        ];
      }
    },

    migrarDados() {
      // Adicionar campos novos para dados antigos
      state.clientes.forEach(cliente => {
        if (!cliente.telefone) cliente.telefone = '';
        if (!cliente.observacoes) cliente.observacoes = '';
      });
      
      state.servicos.forEach(servico => {
        if (!servico.duracao) servico.duracao = 60;
        if (!servico.descricao) servico.descricao = '';
      });
      
      state.atendimentos.forEach(atendimento => {
        if (!atendimento.observacoes) atendimento.observacoes = '';
      });
      
      state.config.versao = '2.0.0';
      this.salvar();
    },

    salvar() {
      try {
        localStorage.setItem('manicureApp', JSON.stringify(state));
        return true;
      } catch (e) {
        ui.mostrarToast('Erro ao salvar dados!', 'error');
        return false;
      }
    },

    exportarDados(tipo = 'completo') {
      let dadosExportar;
      
      switch(tipo) {
        case 'financeiro':
          const agora = new Date();
          const inicioMes = new Date(agora.getFullYear(), agora.getMonth(), 1);
          const atendimentosMes = state.atendimentos.filter(a => new Date(a.data) >= inicioMes);
          const receitaTotal = atendimentosMes.reduce((sum, a) => sum + a.valorTotal, 0);
          const receitaRecebida = atendimentosMes
            .filter(a => a.statusPagamento === 'pago')
            .reduce((sum, a) => sum + a.valorTotal, 0);
          
          dadosExportar = {
            periodo: `M√™s de ${agora.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`,
            receitaTotal: receitaTotal,
            receitaRecebida: receitaRecebida,
            pendenteReceber: receitaTotal - receitaRecebida,
            totalAtendimentos: atendimentosMes.length,
            ticketMedio: atendimentosMes.length > 0 ? receitaTotal / atendimentosMes.length : 0,
            exportadoEm: new Date().toISOString()
          };
          break;
        case 'clientes':
          dadosExportar = {
            clientes: state.clientes,
            exportadoEm: new Date().toISOString()
          };
          break;
        case 'servicos':
          dadosExportar = {
            servicos: state.servicos,
            exportadoEm: new Date().toISOString()
          };
          break;
        default:
          dadosExportar = { ...state, exportadoEm: new Date().toISOString() };
      }
      
      const blob = new Blob([JSON.stringify(dadosExportar, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `manicure-${tipo}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      ui.mostrarToast(`${tipo === 'completo' ? 'Dados completos' : 'Relat√≥rio'} exportado com sucesso!`);
    }
  };

  // Clientes
  const clientes = {
    adicionar(dados) {
      const novaCliente = {
        id: utils.gerarId(),
        nome: dados.nome,
        telefone: dados.telefone || '',
        observacoes: dados.observacoes || '',
        dataCadastro: new Date().toISOString(),
        totalGasto: 0,
        totalAtendimentos: 0,
        ultimaVisita: null
      };
      state.clientes.push(novaCliente);
      storage.salvar();
      this.renderizar();
      agendamentos.atualizarSelectClientes();
      ui.mostrarToast('Cliente adicionada com sucesso!');
      return novaCliente.id;
    },

    remover(id) {
      if (confirm('Tem certeza que deseja remover esta cliente e todos os seus agendamentos?')) {
        state.clientes = state.clientes.filter(c => c.id !== id);
        // Remover agendamentos da cliente
        state.agendamentos = state.agendamentos.filter(a => a.clienteId !== id);
        storage.salvar();
        this.renderizar();
        agendamentos.atualizarSelectClientes();
        agendamentos.renderizar();
        ui.mostrarToast('Cliente removida com sucesso!');
      }
    },

    buscar(nome) {
      if (!nome) return state.clientes;
      const termo = nome.toLowerCase();
      return state.clientes.filter(cliente => 
        cliente.nome.toLowerCase().includes(termo) ||
        (cliente.telefone && cliente.telefone.includes(termo))
      );
    },

    renderizar(lista = state.clientes) {
      const container = document.getElementById('lista-clientes');
      
      if (lista.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">üë•</div><div class="empty-text">Nenhuma cliente encontrada</div><div class="empty-subtext">Adicione sua primeira cliente usando o formul√°rio acima</div></div>';
        return;
      }
      
      container.innerHTML = lista.map(cliente => `
        <div class="list-item">
          <div class="client-header">
            <div>
              <div class="client-name">${cliente.nome}</div>
              ${cliente.telefone ? `<div class="client-meta">üìû ${utils.formatarTelefone(cliente.telefone)}</div>` : ''}
            </div>
            <div class="text-success">${utils.formatarMoeda(cliente.totalGasto)}</div>
          </div>
          <div class="client-meta">
            ${cliente.ultimaVisita ? `üïí ${utils.formatarData(cliente.ultimaVisita)}` : 'Nunca atendida'}
            | üë• ${cliente.totalAtendimentos || 0} atendimentos
            ${cliente.observacoes ? `<br>üìù ${cliente.observacoes.substring(0, 50)}${cliente.observacoes.length > 50 ? '...' : ''}` : ''}
          </div>
          <div class="client-actions">
            <button class="btn btn-outline" onclick="atendimentos.iniciar('${cliente.id}')">üíÖ Atendimento</button>
            <button class="btn btn-info" onclick="agendamentos.iniciar('${cliente.id}')">üìÖ Agendar</button>
            <button class="btn btn-danger" onclick="clientes.remover('${cliente.id}')">üóëÔ∏è Remover</button>
          </div>
        </div>
      `).join('');
    },

    filtrar(tipo) {
      let listaFiltrada;
      switch(tipo) {
        case 'fieis':
          listaFiltrada = state.clientes.filter(c => (c.totalAtendimentos || 0) >= 3);
          break;
        case 'recentes':
          const umaSemanaAtras = new Date();
          umaSemanaAtras.setDate(umaSemanaAtras.getDate() - 7);
          listaFiltrada = state.clientes.filter(c => new Date(c.dataCadastro) >= umaSemanaAtras);
          break;
        default:
          listaFiltrada = state.clientes;
      }
      this.renderizar(listaFiltrada);
      ui.mostrarToast(`${listaFiltrada.length} clientes encontradas`);
    }
  };

  // Servi√ßos
  const servicos = {
    adicionar(dados) {
      const novoServico = {
        id: utils.gerarId(),
        ...dados,
        ativo: document.getElementById('servico-ativo').checked,
        vendas: 0,
        duracao: parseInt(dados.duracao) || 60,
        descricao: dados.descricao || ''
      };
      state.servicos.push(novoServico);
      storage.salvar();
      this.renderizar();
      this.atualizarEstatisticas();
      agendamentos.atualizarSelectServicos();
      ui.mostrarToast('Servi√ßo adicionado com sucesso!');
    },

    remover(id) {
      if (confirm('Tem certeza que deseja remover este servi√ßo?')) {
        state.servicos = state.servicos.filter(s => s.id !== id);
        storage.salvar();
        this.renderizar();
        this.atualizarEstatisticas();
        agendamentos.atualizarSelectServicos();
        ui.mostrarToast('Servi√ßo removido com sucesso!');
      }
    },

    toggleAtivo(id) {
      const servico = state.servicos.find(s => s.id === id);
      if (servico) {
        servico.ativo = !servico.ativo;
        storage.salvar();
        this.renderizar();
        this.atualizarEstatisticas();
        agendamentos.atualizarSelectServicos();
        ui.mostrarToast(`Servi√ßo ${servico.ativo ? 'ativado' : 'desativado'}!`);
      }
    },

    renderizar(lista = state.servicos) {
      const container = document.getElementById('lista-servicos');
      
      if (lista.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">üíÖ</div><div class="empty-text">Nenhum servi√ßo encontrado</div><div class="empty-subtext">Adicione seu primeiro servi√ßo usando o formul√°rio acima</div></div>';
        return;
      }
      
      container.innerHTML = lista.map(servico => `
        <div class="list-item ${!servico.ativo ? 'text-muted' : ''}">
          <div class="client-header">
            <div>
              <div class="client-name">${servico.nome}</div>
              ${servico.descricao ? `<div class="client-meta">${servico.descricao}</div>` : ''}
            </div>
            <div class="text-success">${utils.formatarMoeda(servico.preco)}</div>
          </div>
          <div class="client-meta">
            <span class="service-tag">${servico.categoria}</span>
            | ‚è±Ô∏è ${servico.duracao} min
            ${servico.vendas ? `| üéØ ${servico.vendas} vendas` : ''}
            ${!servico.ativo ? '| ‚ùå Inativo' : ''}
          </div>
          <div class="client-actions">
            <button class="btn btn-${servico.ativo ? 'warning' : 'success'}" onclick="servicos.toggleAtivo('${servico.id}')">
              ${servico.ativo ? '‚ùå Desativar' : '‚úÖ Ativar'}
            </button>
            <button class="btn btn-danger" onclick="servicos.remover('${servico.id}')">üóëÔ∏è Remover</button>
          </div>
        </div>
      `).join('');
    },

    filtrar(tipo) {
      let listaFiltrada;
      switch(tipo) {
        case 'ativos':
          listaFiltrada = state.servicos.filter(s => s.ativo);
          break;
        case 'populares':
          listaFiltrada = state.servicos.filter(s => s.vendas > 0).sort((a, b) => b.vendas - a.vendas);
          break;
        default:
          listaFiltrada = state.servicos;
      }
      this.renderizar(listaFiltrada);
      ui.mostrarToast(`${listaFiltrada.length} servi√ßos encontrados`);
    },

    atualizarEstatisticas() {
      const total = state.servicos.length;
      const ativos = state.servicos.filter(s => s.ativo).length;
      const maisVendido = state.servicos.reduce((max, s) => s.vendas > (max?.vendas || 0) ? s : max, null);
      
      document.getElementById('total-servicos').textContent = total;
      document.getElementById('servicos-ativos').textContent = ativos;
      document.getElementById('servico-mais-vendido').textContent = maisVendido ? maisVendido.nome.substring(0, 10) + '...' : '-';
    }
  };

  // Atendimentos
  const atendimentos = {
    iniciar(clienteId) {
      const cliente = state.clientes.find(c => c.id === clienteId);
      if (!cliente) return;
      
      document.getElementById('atendimento-cliente-id').value = clienteId;
      document.getElementById('atendimento-cliente-info').textContent = cliente.nome;
      document.getElementById('atendimento-data').value = new Date().toISOString().split('T')[0];
      document.getElementById('atendimento-observacoes').value = '';
      
      const servicosContainer = document.getElementById('lista-servicos-modal');
      servicosContainer.innerHTML = state.servicos
        .filter(s => s.ativo)
        .map(servico => `
          <div class="service-option">
            <input type="checkbox" class="service-checkbox" value="${servico.id}" data-preco="${servico.preco}" onchange="atendimentos.calcularTotal()">
            <div class="service-info">
              <div class="service-name">${servico.nome}</div>
              <div class="service-price">${utils.formatarMoeda(servico.preco)}</div>
            </div>
          </div>
        `).join('');
      
      this.calcularTotal();
      ui.abrirModal('modal-atendimento');
    },

    calcularTotal() {
      const checkboxes = document.querySelectorAll('.service-checkbox:checked');
      const total = Array.from(checkboxes).reduce((sum, cb) => sum + parseFloat(cb.dataset.preco), 0);
      document.getElementById('atendimento-valor-total').value = utils.formatarMoeda(total);
    },

    salvar(dados) {
      const atendimento = {
        id: utils.gerarId(),
        ...dados,
        dataCriacao: new Date().toISOString()
      };
      
      state.atendimentos.push(atendimento);
      
      // Atualizar cliente
      const cliente = state.clientes.find(c => c.id === dados.clienteId);
      if (cliente) {
        cliente.ultimaVisita = dados.data;
        cliente.totalAtendimentos = (cliente.totalAtendimentos || 0) + 1;
        if (dados.statusPagamento === 'pago') {
          cliente.totalGasto = (cliente.totalGasto || 0) + dados.valorTotal;
        }
      }
      
      // Atualizar vendas dos servi√ßos
      dados.servicos.forEach(servicoAtendimento => {
        const servico = state.servicos.find(s => s.id === servicoAtendimento.id);
        if (servico) servico.vendas = (servico.vendas || 0) + 1;
      });
      
      storage.salvar();
      clientes.renderizar();
      servicos.atualizarEstatisticas();
      relatorios.atualizar();
      ui.mostrarToast('Atendimento registrado com sucesso!');
    }
  };

  // Agendamentos
  const agendamentos = {
    currentDate: new Date(),
    
    adicionar(dados) {
      const novoAgendamento = {
        id: utils.gerarId(),
        ...dados,
        status: 'agendado',
        dataCriacao: new Date().toISOString()
      };
      state.agendamentos.push(novoAgendamento);
      storage.salvar();
      this.renderizar();
      this.atualizarEstatisticas();
      ui.mostrarToast('Agendamento realizado com sucesso!');
      return novoAgendamento.id;
    },

    cancelar(id) {
      const agendamento = state.agendamentos.find(a => a.id === id);
      if (agendamento && confirm('Tem certeza que deseja cancelar este agendamento?')) {
        agendamento.status = 'cancelado';
        storage.salvar();
        this.renderizar();
        this.atualizarEstatisticas();
        ui.mostrarToast('Agendamento cancelado!');
      }
    },

    concluir(id) {
      const agendamento = state.agendamentos.find(a => a.id === id);
      if (agendamento) {
        agendamento.status = 'concluido';
        storage.salvar();
        this.renderizar();
        this.atualizarEstatisticas();
        ui.mostrarToast('Agendamento conclu√≠do!');
        
        // Oferecer para criar um atendimento
        if (confirm('Deseja criar um atendimento para este agendamento?')) {
          const cliente = state.clientes.find(c => c.id === agendamento.clienteId);
          if (cliente) {
            atendimentos.iniciar(cliente.id);
            // Preencher automaticamente os servi√ßos
            setTimeout(() => {
              agendamento.servicos.forEach(servicoId => {
                const checkbox = document.querySelector(`.service-checkbox[value="${servicoId}"]`);
                if (checkbox) checkbox.checked = true;
              });
              atendimentos.calcularTotal();
            }, 100);
          }
        }
      }
    },

    iniciar(clienteId = '') {
      document.getElementById('agendamento-cliente').value = clienteId;
      document.getElementById('agendamento-datahora').value = '';
      document.getElementById('agendamento-observacoes').value = '';
      
      // Limpar sele√ß√£o de servi√ßos
      document.querySelectorAll('#lista-servicos-agendamento input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
    },

    atualizarSelectClientes() {
      const select = document.getElementById('agendamento-cliente');
      select.innerHTML = '<option value="">Selecione uma cliente</option>';
      state.clientes.forEach(cliente => {
        const option = document.createElement('option');
        option.value = cliente.id;
        option.textContent = cliente.nome;
        select.appendChild(option);
      });
    },

    atualizarSelectServicos() {
      const container = document.getElementById('lista-servicos-agendamento');
      container.innerHTML = state.servicos
        .filter(s => s.ativo)
        .map(servico => `
          <div class="service-option">
            <input type="checkbox" class="service-checkbox" value="${servico.id}" data-duracao="${servico.duracao}">
            <div class="service-info">
              <div class="service-name">${servico.nome}</div>
              <div class="service-price">${utils.formatarMoeda(servico.preco)} - ‚è±Ô∏è ${servico.duracao} min</div>
            </div>
          </div>
        `).join('');
    },

    renderizar() {
      const container = document.getElementById('lista-agendamentos');
      const agora = new Date();
      const agendamentosFuturos = state.agendamentos
        .filter(a => a.status === 'agendado' && new Date(a.dataHora) >= agora)
        .sort((a, b) => new Date(a.dataHora) - new Date(b.dataHora));
      
      if (agendamentosFuturos.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìÖ</div><div class="empty-text">Nenhum agendamento futuro</div><div class="empty-subtext">Agende um novo hor√°rio usando o formul√°rio acima</div></div>';
        return;
      }
      
      container.innerHTML = agendamentosFuturos.map(agendamento => {
        const cliente = state.clientes.find(c => c.id === agendamento.clienteId);
        const servicosNomes = agendamento.servicos.map(id => {
          const servico = state.servicos.find(s => s.id === id);
          return servico ? servico.nome : 'Servi√ßo n√£o encontrado';
        });
        
        return `
          <div class="list-item">
            <div class="client-header">
              <div class="client-name">${cliente ? cliente.nome : 'Cliente n√£o encontrado'}</div>
              <div class="text-info">${utils.formatarDataHora(agendamento.dataHora)}</div>
            </div>
            <div class="client-meta">
              üìã ${servicosNomes.join(', ')}
              ${agendamento.observacoes ? `<br>üìù ${agendamento.observacoes}` : ''}
            </div>
            <div class="client-actions">
              <button class="btn btn-success" onclick="agendamentos.concluir('${agendamento.id}')">‚úÖ Concluir</button>
              <button class="btn btn-warning" onclick="agendamentos.cancelar('${agendamento.id}')">‚ùå Cancelar</button>
            </div>
          </div>
        `;
      }).join('');
    },

    criarCalendario() {
      const container = document.getElementById('calendar');
      const monthTitle = document.getElementById('current-month');
      
      const year = this.currentDate.getFullYear();
      const month = this.currentDate.getMonth();
      
      // Atualizar t√≠tulo do m√™s
      monthTitle.textContent = this.currentDate.toLocaleDateString('pt-BR', { 
        month: 'long', 
        year: 'numeric' 
      });
      
      // Obter primeiro dia do m√™s e √∫ltimo dia
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      
      // Dias da semana
      const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
      let calendarHTML = '';
      
      // Adicionar cabe√ßalho dos dias da semana
      weekdays.forEach(day => {
        calendarHTML += `<div class="calendar-day" style="font-weight: bold; background: transparent;">${day}</div>`;
      });
      
      // Espa√ßos vazios antes do primeiro dia
      const startingDay = firstDay.getDay();
      for (let i = 0; i < startingDay; i++) {
        calendarHTML += '<div class="calendar-day"></div>';
      }
      
      // Dias do m√™s
      const hoje = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(year, month, day);
        const hasEvent = state.agendamentos.some(a => {
          const agendamentoDate = new Date(a.dataHora);
          return agendamentoDate.getDate() === day && 
                 agendamentoDate.getMonth() === month && 
                 agendamentoDate.getFullYear() === year &&
                 a.status === 'agendado';
        });
        
        const isToday = currentDate.toDateString() === hoje.toDateString();
        const isPast = currentDate < hoje && !isToday;
        
        calendarHTML += `
          <div class="calendar-day ${isToday ? 'active' : ''} ${isPast ? 'text-muted' : ''} ${hasEvent ? 'has-event' : ''}"
               onclick="agendamentos.selecionarDia(${day})">
            ${day}
          </div>
        `;
      }
      
      container.innerHTML = calendarHTML;
    },
    
    selecionarDia(dia) {
      const year = this.currentDate.getFullYear();
      const month = this.currentDate.getMonth();
      const dataSelecionada = new Date(year, month, dia);
      
      // Preencher o formul√°rio com a data selecionada
      const dataHoraInput = document.getElementById('agendamento-datahora');
      const dataISO = dataSelecionada.toISOString().split('T')[0];
      const horaPadrao = '10:00';
      dataHoraInput.value = `${dataISO}T${horaPadrao}`;
      
      ui.mostrarToast(`Data ${dia}/${month + 1} selecionada`);
    },
    
    proximoMes() {
      this.currentDate.setMonth(this.currentDate.getMonth() + 1);
      this.criarCalendario();
    },
    
    mesAnterior() {
      this.currentDate.setMonth(this.currentDate.getMonth() - 1);
      this.criarCalendario();
    },

    atualizarEstatisticas() {
      const hoje = new Date();
      const inicioDia = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
      const fimDia = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate() + 1);
      
      const agendamentosHoje = state.agendamentos.filter(a => {
        const dataAgendamento = new Date(a.dataHora);
        return dataAgendamento >= inicioDia && dataAgendamento < fimDia && a.status === 'agendado';
      }).length;
      
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - hoje.getDay());
      inicioSemana.setHours(0, 0, 0, 0);
      
      const agendamentosSemana = state.agendamentos.filter(a => {
        const dataAgendamento = new Date(a.dataHora);
        return dataAgendamento >= inicioSemana && a.status === 'agendado';
      }).length;
      
      const totalAgendamentos = state.agendamentos.length;
      const agendamentosConcluidos = state.agendamentos.filter(a => a.status === 'concluido').length;
      const taxaComparecimento = totalAgendamentos > 0 ? 
        Math.round((agendamentosConcluidos / totalAgendamentos) * 100) : 0;
      
      document.getElementById('agendamentos-hoje').textContent = agendamentosHoje;
      document.getElementById('agendamentos-semana').textContent = agendamentosSemana;
      document.getElementById('taxa-comparecimento').textContent = taxaComparecimento + '%';
    }
  };

  // Relat√≥rios
  const relatorios = {
    atualizar() {
      const agora = new Date();
      const inicioMes = new Date(agora.getFullYear(), agora.getMonth(), 1);
      const inicioMesAnterior = new Date(agora.getFullYear(), agora.getMonth() - 1, 1);
      const fimMesAnterior = new Date(agora.getFullYear(), agora.getMonth(), 0);
      
      // C√°lculos do m√™s atual
      const pendente = state.atendimentos
        .filter(a => a.statusPagamento === 'pendente')
        .reduce((sum, a) => sum + a.valorTotal, 0);
      
      const recebidoMes = state.atendimentos
        .filter(a => new Date(a.data) >= inicioMes && a.statusPagamento === 'pago')
        .reduce((sum, a) => sum + a.valorTotal, 0);
      
      const totalMes = state.atendimentos
        .filter(a => new Date(a.data) >= inicioMes)
        .reduce((sum, a) => sum + a.valorTotal, 0);
      
      const atendimentosMes = state.atendimentos.filter(a => new Date(a.data) >= inicioMes).length;
      const ticketMedio = atendimentosMes > 0 ? totalMes / atendimentosMes : 0;
      
      // Clientes do m√™s
      const clientesMes = [...new Set(
        state.atendimentos
          .filter(a => new Date(a.data) >= inicioMes)
          .map(a => a.clienteId)
      )].length;
      
      // Clientes fi√©is (3+ atendimentos)
      const clientesFieis = state.clientes.filter(c => (c.totalAtendimentos || 0) >= 3).length;
      
      // C√°lculos do m√™s anterior para compara√ß√£o
      const totalMesAnterior = state.atendimentos
        .filter(a => new Date(a.data) >= inicioMesAnterior && new Date(a.data) <= fimMesAnterior)
        .reduce((sum, a) => sum + a.valorTotal, 0);
      
      const clientesMesAnterior = [...new Set(
        state.atendimentos
          .filter(a => new Date(a.data) >= inicioMesAnterior && new Date(a.data) <= fimMesAnterior)
          .map(a => a.clienteId)
      )].length;
      
      // Atualizar KPIs
      document.getElementById('kpi-pendente').textContent = utils.formatarMoeda(pendente);
      document.getElementById('kpi-recebido').textContent = utils.formatarMoeda(recebidoMes);
      document.getElementById('kpi-total').textContent = utils.formatarMoeda(totalMes);
      document.getElementById('kpi-clientes').textContent = clientesMes;
      document.getElementById('total-clientes').textContent = state.clientes.length;
      document.getElementById('atendimentos-mes').textContent = atendimentosMes;
      document.getElementById('ticket-medio').textContent = utils.formatarMoeda(ticketMedio);
      document.getElementById('clientes-fieis').textContent = clientesFieis;
      
      // Atualizar comparativos
      const diffFaturamento = utils.calcularDiferencaPercentual(totalMes, totalMesAnterior);
      const diffClientes = utils.calcularDiferencaPercentual(clientesMes, clientesMesAnterior);
      
      const comparativoMes = document.getElementById('comparativo-mes');
      const comparativoClientes = document.getElementById('comparativo-clientes');
      
      comparativoMes.textContent = `${diffFaturamento > 0 ? '+' : ''}${diffFaturamento}%`;
      comparativoMes.className = `comparison-value ${diffFaturamento > 0 ? 'positive' : diffFaturamento < 0 ? 'negative' : 'neutral'}`;
      
      comparativoClientes.textContent = `${diffClientes > 0 ? '+' : ''}${diffClientes}%`;
      comparativoClientes.className = `comparison-value ${diffClientes > 0 ? 'positive' : diffClientes < 0 ? 'negative' : 'neutral'}`;
    },

    criarGraficos() {
      this.criarGraficoFaturamento();
      this.criarGraficoServicos();
    },

    criarGraficoFaturamento() {
      const container = document.getElementById('grafico-faturamento');
      const meses = [];
      const valores = [];
      
      // Gerar dados dos √∫ltimos 6 meses
      for (let i = 5; i >= 0; i--) {
        const data = new Date();
        data.setMonth(data.getMonth() - i);
        const mes = data.toLocaleDateString('pt-BR', { month: 'short' });
        meses.push(mes);
        
        const inicioMes = new Date(data.getFullYear(), data.getMonth(), 1);
        const fimMes = new Date(data.getFullYear(), data.getMonth() + 1, 0);
        
        const faturamento = state.atendimentos
          .filter(a => {
            const dataAtendimento = new Date(a.data);
            return dataAtendimento >= inicioMes && dataAtendimento <= fimMes;
          })
          .reduce((sum, a) => sum + a.valorTotal, 0);
        
        valores.push(faturamento);
      }
      
      const maxValor = Math.max(...valores, 1);
      
      container.innerHTML = valores.map((valor, index) => {
        const altura = (valor / maxValor) * 100;
        return `
          <div class="bar" style="height: ${altura}%" title="${meses[index]}: ${utils.formatarMoeda(valor)}">
            <div class="bar-value">${utils.formatarMoeda(valor)}</div>
            <div class="bar-label">${meses[index]}</div>
          </div>
        `;
      }).join('');
    },

    criarGraficoServicos() {
      const container = document.getElementById('grafico-servicos');
      const servicosPopulares = state.servicos
        .filter(s => s.vendas > 0)
        .sort((a, b) => b.vendas - a.vendas)
        .slice(0, 6);
      
      const maxVendas = Math.max(...servicosPopulares.map(s => s.vendas), 1);
      
      container.innerHTML = servicosPopulares.map(servico => {
        const altura = (servico.vendas / maxVendas) * 100;
        const nomeAbreviado = servico.nome.length > 8 ? servico.nome.substring(0, 8) + '...' : servico.nome;
        
        return `
          <div class="bar" style="height: ${altura}%" title="${servico.nome}: ${servico.vendas} vendas">
            <div class="bar-value">${servico.vendas}</div>
            <div class="bar-label">${nomeAbreviado}</div>
          </div>
        `;
      }).join('');
    }
  };

  // Backup
  const backup = {
    fazer() {
      const dados = {
        ...state,
        backupRealizadoEm: new Date().toISOString()
      };
      
      localStorage.setItem('manicureApp_backup', JSON.stringify(dados));
      state.config.ultimoBackup = new Date().toISOString();
      storage.salvar();
      
      const backups = JSON.parse(localStorage.getItem('manicureApp_backups') || '[]');
      backups.push({
        data: new Date().toISOString(),
        tamanho: JSON.stringify(dados).length
      });
      
      if (backups.length > 10) {
        backups.shift();
      }
      
      localStorage.setItem('manicureApp_backups', JSON.stringify(backups));
      this.atualizarStatus();
      ui.mostrarToast('Backup realizado com sucesso!');
    },

    restaurar() {
      const fileInput = document.getElementById('arquivo-backup');
      const file = fileInput.files[0];
      
      if (!file) {
        ui.mostrarToast('Selecione um arquivo de backup!', 'error');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const dados = JSON.parse(e.target.result);
          if (dados && dados.clientes && dados.servicos) {
            Object.assign(state, dados);
            storage.salvar();
            ui.mostrarToast('Backup restaurado com sucesso!', 'success');
            setTimeout(() => location.reload(), 1000);
          } else {
            ui.mostrarToast('Arquivo de backup inv√°lido!', 'error');
          }
        } catch (error) {
          ui.mostrarToast('Erro ao ler arquivo de backup!', 'error');
        }
      };
      reader.readAsText(file);
    },

    atualizarStatus() {
      document.getElementById('ultimo-backup').textContent = 
        utils.formatarData(state.config.ultimoBackup);
      
      const dados = localStorage.getItem('manicureApp');
      const tamanho = dados ? Math.round(dados.length / 1024) : 0;
      document.getElementById('armazenamento-usado').textContent = tamanho + ' KB';
      
      document.getElementById('total-registros').textContent = 
        state.clientes.length + state.servicos.length + state.atendimentos.length + state.agendamentos.length;
      
      const backups = JSON.parse(localStorage.getItem('manicureApp_backups') || '[]');
      document.getElementById('backups-realizados').textContent = backups.length;
      
      document.getElementById('versao-app').textContent = state.config.versao;
    }
  };

  // Sistema Offline
  const offline = {
    verificarConexao() {
      const status = document.getElementById('sync-status');
      if (navigator.onLine) {
        status.className = 'sync-status';
        status.innerHTML = '<span class="sync-icon">‚úÖ</span><span class="sync-text">Online</span>';
      } else {
        status.className = 'sync-status offline';
        status.innerHTML = '<span class="sync-icon">‚ö†Ô∏è</span><span class="sync-text">Offline</span>';
      }
    }
  };

  // Inicializa√ß√£o
  function inicializarApp() {
    // Carregar dados
    storage.carregar();
    
    // Aplicar tema
    ui.aplicarTema();
    
    // Configurar event listeners
    configurarEventListeners();
    
    // Verificar conex√£o
    offline.verificarConexao();
    window.addEventListener('online', offline.verificarConexao);
    window.addEventListener('offline', offline.verificarConexao);
    
    // Iniciar backup autom√°tico
    if (state.config.backupAutomatico) {
      setInterval(() => {
        if (navigator.onLine) {
          backup.fazer();
        }
      }, 5 * 60 * 1000);
    }
    
    // Renderizar dados iniciais
    clientes.renderizar();
    servicos.renderizar();
    servicos.atualizarEstatisticas();
    agendamentos.atualizarSelectClientes();
    agendamentos.atualizarSelectServicos();
    agendamentos.renderizar();
    agendamentos.atualizarEstatisticas();
    relatorios.atualizar();
    backup.atualizarStatus();
    
    ui.mostrarToast('Aplica√ß√£o carregada com sucesso!');
  }

  function configurarEventListeners() {
    // Navega√ß√£o entre abas
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const abaId = e.currentTarget.getAttribute('data-tab');
        ui.mudarAba(abaId);
      });
    });
    
    // Tema
    document.getElementById('theme-toggle').addEventListener('click', () => ui.toggleTheme());
    
    // Formul√°rio de cliente
    document.getElementById('form-cliente').addEventListener('submit', (e) => {
      e.preventDefault();
      const nome = document.getElementById('cliente-nome').value.trim();
      const telefone = document.getElementById('cliente-telefone').value.trim();
      const observacoes = document.getElementById('cliente-observacoes').value.trim();
      
      if (nome) {
        clientes.adicionar({ nome, telefone, observacoes });
        e.target.reset();
      }
    });
    
    // Busca de clientes
    document.getElementById('busca-cliente').addEventListener('input', utils.debounce((e) => {
      const termo = e.target.value.trim();
      const resultados = clientes.buscar(termo);
      clientes.renderizar(resultados);
    }, 300));
    
    // Formul√°rio de servi√ßo
    document.getElementById('form-servico').addEventListener('submit', (e) => {
      e.preventDefault();
      const nome = document.getElementById('servico-nome').value.trim();
      const preco = document.getElementById('servico-preco').value;
      const duracao = document.getElementById('servico-duracao').value;
      const categoria = document.getElementById('servico-categoria').value;
      const descricao = document.getElementById('servico-descricao').value.trim();
      
      if (nome && preco) {
        servicos.adicionar({ 
          nome, 
          preco: parseFloat(preco), 
          duracao,
          categoria,
          descricao
        });
        e.target.reset();
      }
    });
    
    // Formul√°rio de agendamento
    document.getElementById('form-agendamento').addEventListener('submit', (e) => {
      e.preventDefault();
      const clienteId = document.getElementById('agendamento-cliente').value;
      const dataHora = document.getElementById('agendamento-datahora').value;
      const observacoes = document.getElementById('agendamento-observacoes').value.trim();
      
      const servicosSelecionados = Array.from(document.querySelectorAll('#lista-servicos-agendamento .service-checkbox:checked'));
      
      if (!clienteId || !dataHora || servicosSelecionados.length === 0) {
        ui.mostrarToast('Preencha todos os campos obrigat√≥rios!', 'error');
        return;
      }
      
      const servicosIds = servicosSelecionados.map(cb => cb.value);
      
      agendamentos.adicionar({
        clienteId,
        dataHora,
        servicos: servicosIds,
        observacoes
      });
      
      e.target.reset();
    });
    
    // Formul√°rio de atendimento
    document.getElementById('form-atendimento').addEventListener('submit', (e) => {
      e.preventDefault();
      const servicosSelecionados = Array.from(document.querySelectorAll('.service-checkbox:checked'));
      
      if (servicosSelecionados.length === 0) {
        ui.mostrarToast('Selecione pelo menos um servi√ßo!', 'error');
        return;
      }
      
      const servicosData = servicosSelecionados.map(cb => {
        const servico = state.servicos.find(s => s.id === cb.value);
        return { id: servico.id, nome: servico.nome, preco: servico.preco };
      });
      
      const valorTotal = servicosData.reduce((sum, s) => sum + s.preco, 0);
      
      atendimentos.salvar({
        clienteId: document.getElementById('atendimento-cliente-id').value,
        data: document.getElementById('atendimento-data').value,
        servicos: servicosData,
        valorTotal: valorTotal,
        statusPagamento: document.getElementById('atendimento-status-pagamento').value,
        observacoes: document.getElementById('atendimento-observacoes').value
      });
      
      e.target.reset();
      ui.fecharModal('modal-atendimento');
    });
    
    // Filtros de clientes
    document.querySelectorAll('#clientes .quick-action-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const filtro = e.currentTarget.getAttribute('data-filter');
        clientes.filtrar(filtro);
      });
    });
    
    // Filtros de servi√ßos
    document.querySelectorAll('#servicos .quick-action-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const filtro = e.currentTarget.getAttribute('data-filter');
        servicos.filtrar(filtro);
      });
    });
    
    // Calend√°rio
    document.getElementById('prev-month').addEventListener('click', () => agendamentos.mesAnterior());
    document.getElementById('next-month').addEventListener('click', () => agendamentos.proximoMes());
    
    // Backup
    document.getElementById('btn-backup').addEventListener('click', () => backup.fazer());
    
    // Exporta√ß√£o
    document.querySelectorAll('[data-export]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const tipo = e.currentTarget.getAttribute('data-export');
        storage.exportarDados(tipo);
      });
    });
    
    // Restaurar backup
    document.getElementById('btn-restaurar').addEventListener('click', () => backup.restaurar());
    
    // Backup autom√°tico
    document.getElementById('backup-automatico').addEventListener('change', function() {
      state.config.backupAutomatico = this.checked;
      storage.salvar();
    });
    
    // Fechar modais
    document.querySelectorAll('.modal-close').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const modal = e.target.closest('.modal');
        if (modal) {
          ui.fecharModal(modal.id);
        }
      });
    });
    
    // Fechar modal ao clicar fora
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          ui.fecharModal(modal.id);
        }
      });
    });
  }

  // Iniciar aplica√ß√£o
  document.addEventListener('DOMContentLoaded', inicializarApp);
  </script>
</body>
</html>
